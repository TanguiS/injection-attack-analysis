<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consent</title>

    <style>
        body {
            background-color: lightgray;
        }
        .container {
            width: 70ch;
            margin: 6em auto;
            line-height: calc(1ex / 0.32);
        }
        p {
            font-size: 1.1em;
            margin: calc(1ex / 0.32) 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Consent form</h1>
        <h3>Biometric Processing</h3>
        <p>
            A live image will be captured of the person physically present at the location. This image will be used in comparison with the 
            image stored in the ID document provided by the same person. 
        </p>
        <form action="{{postback_url}}" id="consent-form"> 
            <input type="hidden" name="text_version" value="1.3.5" id="text-version">
            <label for="binding-info">
                Identifier:
                <input type="text" name="binding_info" id="binding-info">
            </label>
            
            <input type="submit" value="Consent">
        </form>
    </div>
    <script>
        async function postFormDataAsJson({ url, formData }) {
	        const plainFormData = Object.fromEntries(formData.entries());
	        const formDataJsonString = JSON.stringify(plainFormData);

            const fetchOptions = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Accept: "application/json",
                },
                body: formDataJsonString,
            };

	        const response = await fetch(url, fetchOptions);

            if (!response.ok) {
                const errorMessage = await response.text();
                throw new Error(errorMessage);
            }

	        return response.json();
        }

        async function handleFormSubmit(event) {
	        event.preventDefault();

	        const form = event.currentTarget;
	        const url = form.action;

	        try {
		        const formData = new FormData(form);
		        const responseData = await postFormDataAsJson({ url, formData });

		        console.log({ responseData });
                document.body.innerHTML = "Consent Successfully Submitted";
	        } catch (error) {
		        console.error(error);
	        }
        }

        const exampleForm = document.getElementById("consent-form");
        exampleForm.addEventListener("submit", handleFormSubmit);
    </script>
</body>
</html>